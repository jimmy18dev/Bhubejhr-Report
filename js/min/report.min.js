var api_report="api/report.php",api_category="api/category.php";$(document).ready(function(){function e(){$(".category-menu").hide(),$(".category-menu").html('กำลังโหลด<i class="fa fa-circle-o-notch fa-spin" aria-hidden="true"></i>'),$(".edit-menu").hide()}var t,r;autosize($("textarea")),$createReportForm=$("#reportForm"),$btnClose=$createReportForm.children(".topic").children(".btn-close-dialog"),$btnCreateReport=$("#btnCreateReport"),$btnSubmitReport=$("#btnSubmitReport"),$formProgress=$("#formProgress"),$createReportForm.ajaxForm({beforeSubmit:function(){$formProgress.fadeIn(100),$formProgress.width("0%"),$btnSubmitReport.prop("disabled",!0),$btnSubmitReport.addClass("loading"),$btnSubmitReport.html("กำลังบันทึก")},uploadProgress:function(e,t,r,o){var a=o;a=80*a/100,$formProgress.animate({width:a+"%"},100)},success:function(){$formProgress.animate({width:"90%"},300)},complete:function(e){$formProgress.animate({width:"100%"},300),console.log(e.responseText),console.log(e.responseJSON),setTimeout(function(){location.reload()},1e3)}}),$("#btnCreateReport").click(function(){$createReportForm.addClass("open"),$overlay.addClass("open")}),$btnClose.click(function(){$createReportForm.removeClass("open"),$overlay.removeClass("open"),$("#report_id").val(""),$("#name").val(""),$("#desc").val(""),$("#url").val("")}),$(".edit").click(function(r){r.stopPropagation(),t=$(this).parent().attr("data-id"),e(),$submenu=$(this).children(".edit-menu"),$submenu.show()}),$(".edit").on("click",".btn-editor",function(){$.ajax({url:api_report,cache:!1,dataType:"json",type:"GET",data:{request:"get",report_id:t},error:function(e){console.log("Request Error",e.responseText)}}).done(function(t){console.log(t.data),$("#report_id").val(t.data.report_id),$("#name").val(t.data.report_name),$("#desc").val(t.data.report_desc),$("#url").val(t.data.report_url),$createReportForm.addClass("open"),$overlay.addClass("open"),e()})}),$(".edit").on("click",".op-items",function(e){e.stopPropagation(),$progressbar.fadeIn(300),$progressbar.width("0%"),$progressbar.animate({width:"70%"},500);var r=$(this).attr("data-op");console.log(t+"/"+r),""!=r&&$.ajax({url:api_report,cache:!1,dataType:"json",type:"POST",data:{request:r,report_id:t},error:function(e){console.log("Request Error",e.responseText)}}).done(function(e){console.log(e),location.reload()})}),$(".category-menu").on("click",".category-create",function(e){e.stopPropagation(),$inputtext=$(this).children("input"),$inputtext.keypress(function(e){if(13==e.which){var r=$(this).val();$.ajax({url:api_category,cache:!1,dataType:"json",type:"POST",data:{request:"create_and_set",name:r,report_id:t},error:function(e){console.log("Request Error",e.responseText)}}).done(function(){location.reload()})}})}),$(".category-menu").on("click",".category-items",function(r){r.stopPropagation(),$progressbar.fadeIn(300),$progressbar.width("0%"),$progressbar.animate({width:"70%"},500),$current_display=$(this).parent().parent().children("div .current");var o=$(this).attr("data-id"),a=$(this).html();$.ajax({url:api_report,cache:!1,dataType:"json",type:"POST",data:{request:"change_category",report_id:t,category_id:o},error:function(e){console.log("Request Error",e.responseText)}}).done(function(){0==o?location.reload():(e(),$current_display.html(a),$progressbar.animate({width:"100%"},300),$progressbar.fadeOut())})}),$(".category").click(function(o){t=$(this).parent().parent().parent().attr("data-id"),r=$(this).parent().parent().parent().attr("data-category"),console.log(t,r),o.stopPropagation(),e(),$submenu=$(this).children(".category-menu");var a="";$.ajax({url:api_category,cache:!1,dataType:"json",type:"GET",data:{request:"list_all"},error:function(e){console.log("Request Error",e.responseText)}}).done(function(e){console.log(e),a+='<div class="items category-create"><input type="text" placeholder="สร้างใหม่..."></div>',$.each(e.dataset,function(e,t){a+=r==t.id?'<div class="items category-items selected" data-id="'+t.id+'">'+t.name+"</div>":'<div class="items category-items" data-id="'+t.id+'">'+t.name+"</div>"}),a+='<div class="items category-items" data-id="0">ลบหมวดออก</div>',$submenu.html(a),$submenu.show()})}),$(document).click(function(t){$(t.target).closest(".edit-menu").length&&$(t.target).closest(".category-menu").length||e()})});