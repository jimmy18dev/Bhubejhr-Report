var article_id,youtube_key="AIzaSyB5KfCVIK9XviNJ9fNYWwAGhZfRskjGQ_M";$(document).ready(function(){function t(t){$("#swap").removeClass("-toggle"),t?$savedStatus.html('<i class="fa fa-keyboard-o" aria-hidden="true"></i>'):$savedStatus.html('<i class="fa fa-check-circle" aria-hidden="true"></i>')}function e(){$attachForm.removeClass("-toggle"),$insertFilter.fadeOut(100),$btnAttachSubmit.removeClass("-active"),$btnAttachSubmit.html("เพิ่มในบทความ"),$attachFiles.val(""),$attachFilename.html("เลือกไฟล์เอกสาร..."),$attachAlt.val(""),$attachLoading.fadeOut(100),$attachProgress.fadeOut(100)}function a(){$photoForm.removeClass("-toggle"),$insertFilter.fadeOut(100),$imageLoading.fadeOut(),$imageProgress.fadeOut(),$btnImageSubmit.removeClass("-active"),$btnImageRotate.removeClass("-active"),$btnImageSubmit.html("เพิ่มในบทความ"),$imagePreview.html('<span class="btn-choose" id="btnChooseImage"><span class="i"><i class="fa fa-picture-o" aria-hidden="true"></i></span><span class="c">เลือกไฟล์รูปภาพ...</span></span>')}function i(){$youtubeForm.removeClass("-toggle"),$insertFilter.fadeOut(100),$YouTubeID.val(""),$YouTubeTitle.val(""),$videoLink.val(""),$YouTubePreview.html('<span><i class="fa fa-youtube-play" aria-hidden="true"></i></span>'),$btnYouTubeSubmit.removeClass("-active")}function o(t){var e=t.match(/(?:https?:\/{2})?(?:w{3}\.)?youtu(?:be)?\.(?:com|be)(?:\/watch\?v=|\/)([^\s&]+)/);return null!=e?e[1]:0}var n=new MediumEditor(".input-textarea",{placeholder:{text:"เขียนบทความที่นี่...",hideOnClick:!0}});$laodingbar=$("#loading-bar"),$saved=$("#saved-status"),$insertFilter=$("#insertFilter"),$paper=$("#paper"),article_id=$("#article_id").val(),$savedStatus=$("#savedStatus"),$currentCategory=$("#currentCategory"),$btnAddFile=$("#btn-add-file"),$btnAddImage=$("#btn-add-image"),$btnAddYouTube=$("#btn-add-youtube"),$attachForm=$("#attachForm"),$attachAlt=$("#attachAlt"),$attachPreview=$("#attachPreview"),$attachFilename=$("#attachFilename"),$attachLoading=$("#attachLoading"),$attachProgress=$("#attachProgress"),$btnAttachSubmit=$("#btnAttachSubmit"),$btnAttachClose=$("#btnAttachClose"),$attachFiles=$("#attachFiles"),$btnAddFile.click(function(){$attachFiles.click(),$attachForm.addClass("-toggle"),$insertFilter.fadeIn(100)}),$btnAttachClose.click(e),$attachPreview.click(function(){$attachFiles.focus().click()}),$attachFiles.change(function(){var t=this.files,e=t[0],a=e.name.substring(0,e.name.lastIndexOf("."));console.log(e),$attachFilename.html(e.name),$attachAlt.val(a),$btnAttachSubmit.addClass("-active")}),$btnAttachSubmit.click(function(){$attachForm.submit()}),$attachForm.ajaxForm({beforeSubmit:function(){$attachLoading.fadeIn(100),$attachProgress.fadeIn(100),$attachProgress.width("0%"),$btnAttachSubmit.html("กำลังบันทึก..."),$btnAttachSubmit.removeClass("-active"),$attachForm.clearForm()},uploadProgress:function(t,e,a,i){var o=i;o=80*o/100,$attachProgress.animate({width:o+"%"},100)},success:function(){$attachProgress.animate({width:"100%"},300)},complete:function(t){console.log(t.responseJSON);var a=t.responseJSON.file_id,i=t.responseJSON.filename,o=t.responseJSON.alt,n=$('<div class="file-items" id="file'+a+'" data-id="'+a+'"><div class="icon"><i class="fa fa-paperclip" aria-hidden="true"></i></div><div class="info"><input type="text" class="attach-title" value="'+o+'" placeholder="ชื่อเอกสาร..."><div class="filename">'+i+'<span class="btn-file-remove" title="ลบไฟล์นี้"><i class="fa fa-close" aria-hidden="true"></i>ลบไฟล์</span></div></div></div>');e(),$("#fileList").append(n),$("html,body").animate({scrollTop:$("#file"+a).offset().top},"slow")}}),$photoForm=$("#photoForm"),$imagePreview=$("#imagePreview"),$btnChooseImage=$("#btnChooseImage"),$imageFiles=$("#imageFiles"),$imageLoading=$("#imageLoading"),$imageProgress=$("#imageProgress"),$btnImageSubmit=$("#btnImageSubmit"),$btnImageClose=$("#btnImageClose"),$btnImageRotate=$("#btnImageRotate"),$imageContainer=$("#imageContainer"),$btnAddImage.click(function(){$imageFiles.focus().click(),$photoForm.addClass("-toggle"),$insertFilter.fadeIn(100)}),$btnImageClose.click(function(){var t=$("#content_id").val();$.ajax({url:"api.content.php",cache:!1,dataType:"json",type:"POST",data:{action:"delete_content",content_id:t,article_id:article_id},error:function(){console.log("Request Error")}}).done(function(t){console.log(t),a()})}),$imagePreview.click(function(){$imageFiles.focus().click()}),$imageFiles.change(function(){console.log("file change!");var t=this.files;$imagePreview.html("");var e=t[0],a=/image.*/;console.log("file",e),e.type.match(a)||console.log("Not an Image");var i=document.createElement("img");i.file=e,$imagePreview.append(i);var o=new FileReader;o.onload=function(t){return function(e){t.src=e.target.result}}(i);var n=(o.readAsDataURL(e),document.createElement("canvas"));ctx=n.getContext("2d"),i.onload=function(){ctx.drawImage(i,100,100)},$photoForm.submit()}),$btnImageSubmit.click(function(){var t=$("#content_id").val();$.ajax({url:"api.content.php",cache:!1,dataType:"json",type:"POST",data:{action:"active_content",content_id:t},error:function(t,e,a){console.log(t,e,a),console.log("Request Error")}}).done(function(t){console.log(t);var e=t.content_id,i=t.image_file,o=$('<div class="content-box -edit" id="content'+e+'" data-id="'+e+'"><img src="image/upload/normal/'+i+'"><input type="text" class="input-alt" placeholder="ใส่คำอธิบายภาพ..."><div class="content-controls"><div class="btn btn-content-remove"><i class="fa fa-times" aria-hidden="true"></i></div></div></div>');$paper.append(o),a(),$("html,body").animate({scrollTop:$("#content"+e).offset().top},"slow")})}),$photoForm.ajaxForm({beforeSubmit:function(){$imageLoading.fadeIn(100),$imageProgress.fadeIn(100),$imageProgress.width("0%"),$btnImageSubmit.removeClass("-active"),$photoForm.clearForm()},uploadProgress:function(t,e,a,i){var o=i;o=80*o/100,$imageProgress.animate({width:o+"%"},100),console.log("Upload: "+i+" %")},success:function(){$imageProgress.animate({width:"100%"},300)},complete:function(t){console.log(t.responseText),console.log(t.responseJSON);{var e=t.responseJSON.image_file,a=t.responseJSON.content_id;t.responseJSON.alt}$imagePreview.html('<img src="image/upload/normal/'+e+'">'),$("#content_id").val(a),$imageLoading.fadeOut(100),$imageProgress.fadeOut(100),$btnImageSubmit.addClass("-active"),$btnImageRotate.addClass("-active")}}),$youtubeForm=$("#youtubeForm"),$videoLink=$("#videoLink"),$YouTubePreview=$("#YouTubePreview"),$YouTubeID=$("#YouTubeID"),$YouTubeTitle=$("#YouTubeTitle"),$btnYouTubeClose=$("#btnYouTubeClose"),$btnYouTubeSubmit=$("#btnYouTubeSubmit");var l="";$btnYouTubeClose.click(i),$btnAddYouTube.click(function(){$youtubeForm.addClass("-toggle"),$videoLink.focus(),$insertFilter.fadeIn(300)}),$videoLink.focus(function(){l=$(this).val()}),$videoLink.keyup(function(){var t=$(this).val();if(t==l)return!1;var e=o(t),a='<iframe src="https://www.youtube.com/embed/'+e+'?rel=0&amp;controls=0&amp;showinfo=0"></iframe>';0!=e&&11==e.length?($YouTubePreview.html(a),$btnYouTubeSubmit.addClass("-active"),console.log("video_id",e),$.getJSON("https://www.googleapis.com/youtube/v3/videos?part=snippet&id="+e+"&key="+youtube_key,function(t){var a=t.items[0].snippet.title;console.log(a),$YouTubeTitle.val(a),$YouTubeID.val(e)})):($YouTubePreview.html('<span><i class="fa fa-youtube-play" aria-hidden="true"></i></span>'),$btnYouTubeSubmit.removeClass("-active")),l=t}),$btnYouTubeSubmit.click(function(){var t=$YouTubeID.val(),e=$YouTubeTitle.val();console.log(t,e),$.ajax({url:"api.content.php",cache:!1,dataType:"json",type:"POST",data:{action:"add_youtube",article_id:article_id,youtube_id:t,youtube_title:e},error:function(){console.log("Request Error")}}).done(function(t){console.log(t),i();var e=$('<div class="content-box -edit" id="content'+t.content_id+'" data-id="'+t.content_id+'"><iframe class="youtube_player" src="https://www.youtube.com/embed/'+t.youtube_id+'?rel=0&amp;controls=0&amp;showinfo=0"></iframe><input type="text" class="input-alt" placeholder="ใส่คำอธิบายภาพ..." value="'+t.alt+'"><div class="content-controls"><div class="btn btn-content-remove"><i class="fa fa-times" aria-hidden="true"></i></div></div></div>');$paper.append(e),$("html,body").animate({scrollTop:$("#content"+content_id).offset().top},"slow")})});var r;$("#paper").on("click",".btn-content-swap",function(){$("#swap").addClass("-toggle"),$("#swapFilter").fadeIn(300),r=$(this).parent().parent().attr("data-id"),$.ajax({url:"api.content.php",cache:!1,dataType:"json",type:"POST",data:{action:"list_content",article_id:article_id},error:function(t,e,a){console.log(t,e,a),console.log("Request Error")}}).done(function(t){console.log(t),$("#swap").html(""),$.each(t.items,function(t,e){var a="";if(r==e.id&&(a="-active"),"text"==e.type)var i=$('<div class="swap-items text '+a+'" data-id="'+e.id+'">'+e.message+"</div>");else if("image"==e.type)var i=$('<div class="swap-items '+a+'" data-id="'+e.id+'"><img src="image/upload/thumbnail/'+e.image_file+'"></div>');else if("youtube"==e.type)var i=$('<div class="swap-items '+a+'" data-id="'+e.id+'"><img src="http://img.youtube.com/vi/'+e.message+'/mqdefault.jpg"></div>');$("#swap").append(i)})}),$("#swapFilter").click(function(){$(this).fadeOut(300),$("#swap").removeClass("-toggle")})}),$("#swap").on("click",".swap-items",function(){var t=$(this).attr("data-id");return console.log(r,t),r==t?!1:($.ajax({url:"api.content.php",cache:!1,dataType:"json",type:"POST",data:{action:"swap_content",current_id:r,target_id:t},error:function(t){console.log(t.responseText),console.log("Request Error")}}).done(function(){location.reload()}),void 0)}),$("#paper").on("click",".btn-content-remove",function(){var t=$(this).parent().parent().attr("data-id");return confirm("คุณต้องการลบเนื้อหาส่วนนี้่ ใช่หรือไม่ ?")?($.ajax({url:"api.content.php",cache:!1,dataType:"json",type:"POST",data:{action:"delete_content",content_id:t,article_id:article_id},error:function(t,e,a){console.log(t,e,a),console.log("Request Error")}}).done(function(e){console.log(e),$("#content"+t).remove()}),void 0):!1}),$("#paper").on("click",".input-alt",function(){t(!0),$old=$(this).val(),$(this).blur(function(){var e=$(this).parent().attr("data-id"),a=$(this).val();return $old==a?!1:($laodingbar.width("0%"),$laodingbar.fadeIn(300),$laodingbar.animate({width:"70%"},500),console.log(e,a,article_id),$.ajax({url:"api.content.php",cache:!1,dataType:"json",type:"POST",data:{action:"edit_image_alt",content_id:e,article_id:article_id,image_alt:a},error:function(){console.log("Request Error")}}).done(function(e){console.log(e),$laodingbar.animate({width:"100%"},500),$laodingbar.fadeOut(300),t(!1)}),void 0)})}),$("#fileList").on("click",".btn-file-remove",function(){var t=$(this).parent().parent().parent().attr("data-id");console.log("file_id",t),$.ajax({url:"api.content.php",cache:!1,dataType:"json",type:"POST",data:{action:"delete_file",file_id:t},error:function(){console.log("Request Error")}}).done(function(e){console.log(e),$("#file"+t).fadeOut(500)})}),$("#paper").on("focus",".input-textarea",function(){t(!0);var e=$(this).html();$(this).blur(function(){var a=$(this).parent().attr("data-id"),i=$(this).html();return e==i?!1:($laodingbar.width("0%"),$laodingbar.fadeIn(300),$laodingbar.animate({width:"70%"},500),$.ajax({url:"api.content.php",cache:!1,dataType:"json",type:"POST",data:{action:"edit_content_text",content_id:a,article_id:article_id,message:i},error:function(){console.log("Request Error")}}).done(function(e){console.log(e.message,i),$laodingbar.animate({width:"100%"},500),$laodingbar.fadeOut(300),t(!1)}),void 0)})}),$("#fileList").on("focus",".attach-title",function(){t(!0),$old=$(this).val(),$(this).blur(function(){var e=$(this).parent().parent().attr("data-id"),a=$(this).val();return console.log(e,a),$old==a?!1:($laodingbar.width("0%"),$laodingbar.fadeIn(300),$laodingbar.animate({width:"70%"},500),$.ajax({url:"api.content.php",cache:!1,dataType:"json",type:"POST",data:{action:"edit_file_title",file_id:e,file_title:a},error:function(){console.log("Request Error")}}).done(function(e){console.log(e),$laodingbar.animate({width:"100%"},500),$laodingbar.fadeOut(300),t(!1)}),void 0)})}),$(".btn-published-toggle").click(function(){$laodingbar.width("0%"),$laodingbar.fadeIn(300),$laodingbar.animate({width:"50%"},500),$.ajax({url:"api.content.php",cache:!1,dataType:"json",type:"POST",data:{action:"published_article_toggle",article_id:article_id},error:function(){console.log("Request Error")}}).done(function(t){console.log(t.return),"published"==t.return?($(".btn-published-toggle").html('กำลังเผยแพร่<i class="fa fa-spinner fa-spin" aria-hidden="true"></i>'),$laodingbar.animate({width:"100%"},500),setTimeout(function(){location.reload()},2e3)):($(".btn-published-toggle").html('กำลังดำเนินการ<i class="fa fa-spinner fa-spin" aria-hidden="true"></i>'),$laodingbar.animate({width:"100%"},500),setTimeout(function(){location.reload()},2e3))})}),$("#article_title").focus(function(){t(!0),$old=$(this).val(),$(this).blur(function(){var e=$(this).val();return $old==e?!1:($laodingbar.width("0%"),$laodingbar.fadeIn(300),$laodingbar.animate({width:"50%"},500),$.ajax({url:"api.content.php",cache:!1,dataType:"json",type:"POST",data:{action:"edit_article",title:e,article_id:article_id},error:function(){console.log("Request Error")}}).done(function(e){console.log(e),$laodingbar.animate({width:"100%"},500),$laodingbar.fadeOut(300),t(!1)}),void 0)})}),$("#article_description").focus(function(){t(!0),$b_description=$(this).val(),$(this).blur(function(){var e=$(this).val();return $b_description==e?!1:($laodingbar.width("0%"),$laodingbar.fadeIn(300),$laodingbar.animate({width:"70%"},300),$.ajax({url:"api.content.php",cache:!1,dataType:"json",type:"POST",data:{action:"edit_description_article",description:e,article_id:article_id},error:function(t){console.log(t),console.log("Request Error")}}).done(function(e){console.log(e),t(!1),$laodingbar.animate({width:"100%"},300),$laodingbar.fadeOut(300)}),void 0)})}),$("#btn-add-text").click(function(){console.log("article_id",article_id),$laodingbar.width("0%"),$laodingbar.fadeIn(300),$laodingbar.animate({width:"50%"},500),$.ajax({url:"api.content.php",cache:!1,dataType:"json",type:"POST",data:{action:"create_content",article_id:article_id,type:"text"},error:function(t,e,a){console.log(t,e,a),console.log("Request Error")}}).done(function(t){console.log(t),$laodingbar.animate({width:"100%"},300),$laodingbar.fadeOut(300);var e=t.content_id,a=$('<div class="content-box -edit" id="content'+e+'" data-id="'+e+'"><div class="input-textarea" contenteditable="true"></div><div class="content-controls"><div class="btn btn-content-remove"><i class="fa fa-times" aria-hidden="true"></i></div></div></div>');$paper.append(a),$("html,body").animate({scrollTop:$("#content"+e).offset().top},"slow"),n.addElements(".input-textarea")})}),$(".category-choose-items").click(function(){var t=$(this).attr("data-id"),e=$(this).children("span").html();$category=$(this),$laodingbar.width("0%"),$laodingbar.fadeIn(300),$laodingbar.animate({width:"50%"},500),$.ajax({url:"api.content.php",cache:!1,dataType:"json",type:"POST",data:{action:"edit_category_article",category_id:t,article_id:article_id},error:function(t){console.log(t),console.log("Request Error")}}).done(function(t){console.log(t),$currentCategory.html(e),$(".category-choose-items").removeClass("-active"),$category.addClass("-active"),$laodingbar.animate({width:"100%"},300),$laodingbar.fadeOut(300)})}),$btnImageRotate.click(function(){var t=$("#content_id").val();$img=$imagePreview.children("img"),$imageLoading.fadeIn(100),$imageProgress.fadeIn(100),$imageProgress.width("0%"),$imageProgress.animate({width:"50%"},300),$.ajax({url:"api.content.php",cache:!1,dataType:"json",type:"POST",data:{action:"rotate_image",content_id:t},error:function(t,e,a){console.log(t,e,a),console.log("Request Error")}}).done(function(t){$imageProgress.animate({width:"100%"},300),console.log(t),$img.attr("src",$img.attr("src")+"?"+100*Math.random()),$imageLoading.fadeOut(100),$imageProgress.fadeOut(100)})}),$("#btnOptions , .choose-category").click(function(){$("#moreOptions").addClass("-toggle"),$("#moreOptionsFilter").fadeIn(100),$("#moreOptionsFilter").click(function(){$("#moreOptions").removeClass("-toggle"),$(this).fadeOut(300)})}),$btnDeleteArticle=$("#btnDeleteArticle"),$btnDeleteArticle.click(function(){$.ajax({url:"api.content.php",cache:!1,dataType:"json",type:"POST",data:{action:"delete_article",article_id:article_id},error:function(t,e,a){console.log(t,e,a),console.log("Request Error")}}).done(function(t){console.log(t),window.location="profile.php?"})})});